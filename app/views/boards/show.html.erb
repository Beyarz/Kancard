<% content_for :nav_menu do %>
  <div class="navbar-menu">
    <div class="navbar-end">
      <div class="navbar-item">
        <%= link_to "Home", boards_path, :class => "button" %>
      </div>
    </div>
  </div>
<% end %>

<%= render "boards/panel" %>

<div class="tile is-ancestor">
  <div class="tile is-parent">
    <div class="tile is-child box">
      <p class="title">Chat</p>
      <%= render "boards/chat" %>
    </div>
  </div>
  <div class="tile is-8 is-vertical is-parent">
    <div class="tile is-child box">
      <p class="title">Notes</p>
      <div class="scrollable columns" data-controller="drag" data-drag-url="/boards/:board_id/notes/:id/move">
        <%= render "notes/note", notes: @board.notes %>
      </div>
    </div>
    <div class="tile is-child box">
      <p class="title">Cards</p>
      <div class="scrollable columns">
        <%= render "cards/card", cards: @board.cards %>
      </div>
    </div>
  </div>
</div>

<%= render "cards/modal" %>
<%= render "notes/modal" %>

<% content_for :script do %>
  <script>
    function spreadOutBelongings() {
      const notes = document.querySelectorAll('[data-belongs-to]')

      notes.forEach((note) => {
        const column_id = note.dataset.belongsTo

        if (column_id !== "undefined" && column_id !== "") {
          const column = document.querySelector(`[data-id="${column_id}"]`)
          column.appendChild(note)
        }
      })
    }

    document.addEventListener('turbolinks:load', spreadOutBelongings)
  </script>
<% end %>
